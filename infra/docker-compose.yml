version: "3.8"
services:
  api:
    build: ../apps/api
    ports: ["8000:8000"]
    environment:
      - REDIS_HOST=redis
    depends_on: [redis]
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

  worker:
    build: ../services/worker
    environment:
      - REDIS_HOST=redis
    depends_on: [redis]
    command: python -c "import rq, redis; rq.Worker(['xml'], connection=redis.Redis(host='redis', port=6379)).work()"

  redis:
    image: redis:7
